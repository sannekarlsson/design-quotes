(function(){"use strict";const loader=document.querySelector(".loader");function createDot(){let dotElement=document.createElement("div");dotElement.className="dot";return dotElement}function createDots(quantity){for(let i=0;i<quantity;i++){loader.appendChild(createDot())}}function toggleBubbling(show){let value=show?"running":"paused";let allDots=document.querySelectorAll(".dot");[...allDots].forEach((dot=>{dot.style.WebkitAnimationPlayState=value;dot.style.animationPlayState=value}))}const aQuote={element:document.querySelector("q"),author:document.querySelector("p.author"),endpointUrl:"https://quotesondesign.com/wp-json/wp/v2/posts/",filter:"?orderby=rand&posts_per_page=5"};function initQuote(jsonObj){let cite=jsonObj.link;if(jsonObj.custom_meta){cite=jsonObj.custom_meta.Source;cite.replace(/<\/?a>/g,"").trim()}aQuote.element.setAttribute("cite",cite);let taggedQuote=jsonObj.content.rendered;aQuote.element.innerHTML=taggedQuote.replace(/<\/?p>/g,"").trim();aQuote.author.innerHTML=jsonObj.title.rendered}function getQuoteRequest(){let time=Math.round(Date.now()/1e3);let timestamp="&timestamp="+time;let request=aQuote.endpointUrl+aQuote.filter+timestamp;return request}const wiki={baseUrl:"https://en.wikipedia.org/api/rest_v1",summary:"/page/summary/",info:document.querySelector("p.wiki")};function getWikiSummaryUrl(author){return wiki.baseUrl+wiki.summary+author}function displayWiki(jsonObj){if(jsonObj.extract){wiki.info.textContent=jsonObj.extract}else{wiki.info.textContent=jsonObj.description}wiki.info.setAttribute("data-author",jsonObj.title);wiki.info.style.display="block"}function clearWiki(){wiki.info.style.display="none";wiki.info.setAttribute("data-author","");wiki.info.textContent=""}function noWikiFound(author){wiki.info.innerHTML=`Sorry, there was no Wikipedia entry available. Maybe try a <a href="https://www.google.se/search?q=${author}">Google search?</a>`;wiki.info.setAttribute("data-author",author);wiki.info.style.display="block"}const quote={button:document.querySelector('button[name="quote"]'),collection:[],container:document.querySelector(".quote-container"),default:{content:{rendered:"Perfection is boring. Getting better is where all the fun is."},link:"https://quotesondesign.com/dragos-roua/",title:{rendered:"Dragos Roua"}}};const author={button:document.querySelector('button[name="author"]'),find:"Who is quoted?",hide:"Hide author info"};const loading=document.querySelector(".loader");createDots(5);author.button.addEventListener("click",toggleAuthor);quote.button.addEventListener("click",getQuote);getQuote();function getQuote(){resetWiki();toggleLoaderAndQuote(1);let nextQuote=quote.collection.shift();if(nextQuote){displayQuote(nextQuote)}else{fetchJson(getQuoteRequest(),displayAndStoreQuotes)}}function displayQuote(jsonObj){initQuote(jsonObj);author.button.value=jsonObj.title.rendered;toggleLoaderAndQuote(0)}function displayAndStoreQuotes(jsonObj){displayQuote(jsonObj[0]);for(let i=1;i<jsonObj.length;i++){quote.collection.push(jsonObj[i])}}function fetchJson(request,callback){fetch(request).then((response=>{if(response.ok){return response.json()}else{throw new Error(`Fetch response with status: ${response.status}.`)}})).then((jsonObj=>{callback(jsonObj)})).catch((error=>{noEntryFound(request)}))}function toggleLoaderAndQuote(loaderOpacity){quote.container.style.opacity=loaderOpacity?0:1;loading.style.opacity=loaderOpacity;toggleBubbling(loaderOpacity)}function toggleAuthor(event){let buttonText=author.button.textContent;if(buttonText===author.hide){wiki.info.style.display="none";author.button.textContent=author.find}else{author.button.textContent=author.hide;getWiki(event.target.value)}}function getWiki(author){if(wiki.info.dataset.author===author){wiki.info.style.display="block"}else{let request=getWikiSummaryUrl(author);fetchJson(request,displayWiki)}}function resetWiki(){author.button.textContent=author.find;clearWiki()}function noEntryFound(url){if(url.startsWith(wiki.baseUrl)){noWikiFound(author.button.value)}else{displayQuote(quote.default);displayError(errorElement())}}function errorElement(){const el=document.createElement("p");el.className="no-entry";el.textContent="Sorry, could not fetch quotes. Will hopefully work soon again. This is a default quote in the mean time.";return el}function displayError(errorElement){if(document.querySelector(".no-entry")){return}quote.container.insertBefore(errorElement,document.querySelector(".button-group"));setTimeout((()=>{quote.container.removeChild(errorElement)}),1e4)}})();